{% extends "layout_with_navbar.html" %}
{%block content %}

<!-- Setup Modal -->
<form action="{{ url_for('main.setup') }}" method="POST" enctype="multipart/form-data">
	{{ form.hidden_tag() }}
	<div id="setupModal" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title">Mail Alert Setup</h4>
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				</div>
				<div class="modal-body">
					<p>Upload students csv file</p>
					<input name="file" type="file">
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					<input type="submit" class="btn btn-success" value="Save">
				</div>
			</div>
		</div>
	</div>
</form>

<form action="" method="POST">
    {{ form.hidden_tag() }}
    <div class="card" style="width:500px; margin:0 auto;">
        <div class="card-body">
            <div class="row">
                <div class="col-9">
                    {% if form.student_id.errors %}
                        {{ form.student_id(class="form-control form-control-md is-invalid") }}
                        <div class="invalid-feedback">
                            {% for error in form.student_id.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        {{ form.student_id(class="form-control form-control-md", placeholder='Search for Student') }}
                    {% endif %}
                </div>
                <div class="col-3">
                    {{ form.submit(class="btn btn-success") }}
                </div>
            </div>
        </div>
    </div>
</form>

<h2>Perishable Packages</h2>
    <table id="packagesTable" class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Package&nbsp;#</th>
                <th>Description</th>
                <th>Status</th>
                <th id="deliveryDateLabel">Delivered</th>
                <th>Phone Number</th>
            </tr>
        </thead>
		<tbody>
			{% for package in packages %}
				<tr class="table-danger" data-status="{{ package.status }}">
					<td>{{ package.id }}</td>
					<td>{{ package.description }}</td>
					<td>{{ package.status }}</td>
					<td>{{ package.delivery_date.strftime('%m-%d-%Y') }}</td>
					<td>{{ package.owner.phone_number }}</td>
				</tr>
			{% endfor %}
		</tbody>
	</table>

{% if setup %}
    <script type="text/javascript">
        $(document).ready(function(){
            $("#setupModal").modal('show');
        });
    </script>
{% endif %}

{% endblock %}